import streamlit as st
import pandas as pd
from datetime import datetime, time

# ==========================================
# 1. ÂÖßÂª∫Ë≥áÊñôÂ∫´ (‰øÆÊ≠£Áâà)
# ==========================================
def get_data():
    # Âçó‰∏ãË≥áÊñô (ÂçóÊ∏Ø -> Âè∞Âçó)
    southbound_raw = [
        ["583", "ÊØèÊó•", "06:15", "06:26", "06:34", "06:45", "07:02", "07:13", "07:32", "07:45", "07:56", "08:10", "08:28", "08:40"],
        ["203", "ÊØèÊó•", "-", "06:30", "06:38", "-", "-", "-", "07:20", "-", "-", "07:45", "08:03", "08:15"],
        ["1103", "2/14-2/19, 2/23", "06:35", "06:46", "06:54", "-", "-", "-", "07:35", "-", "-", "-", "-", "08:20"],
        ["603", "ÊØèÊó•", "06:40", "06:51", "07:00", "07:15", "07:27", "07:47", "07:58", "08:17", "08:30", "08:41", "08:55", "09:25"],
        ["1607", "2/14-2/19", "07:10", "07:21", "07:29", "07:43", "07:56", "-", "08:25", "-", "-", "08:50", "09:07", "09:20"],
        ["109", "ÊØèÊó•", "07:20", "07:31", "07:39", "-", "-", "-", "08:20", "-", "-", "-", "-", "09:05"],
        ["1505", "2/13-2/20, 2/25", "07:25", "07:36", "07:46", "08:01", "08:12", "08:22", "08:48", "08:42", "-", "09:14", "09:33", "09:45"],
        ["205", "ÊØèÊó•", "-", "07:40", "07:51", "07:59", "-", "-", "08:40", "-", "-", "-", "09:18", "09:30"],
        ["1305", "2/13-2/21, 2/23", "07:50", "08:01", "08:10", "-", "-", "-", "08:54", "09:05", "09:17", "09:29", "09:47", "10:00"],
        ["809", "ÊØèÊó•", "08:00", "08:11", "08:19", "08:34", "08:47", "08:58", "09:17", "09:30", "09:41", "09:55", "10:13", "10:25"],
        ["613", "ÊØèÊó•", "08:10", "08:21", "08:29", "08:43", "08:56", "-", "09:25", "-", "-", "09:50", "10:07", "10:20"],
        ["207", "ÊØèÊó•", "-", "08:20", "08:39", "-", "-", "-", "09:12", "-", "-", "09:42", "09:58", "10:10"],
        ["615", "ÊØèÊó•", "08:35", "08:46", "08:55", "09:10", "09:22", "-", "09:40", "-", "-", "10:14", "10:33", "10:45"],
        ["1209", "2/13-2/21, 2/23", "08:40", "08:51", "08:59", "-", "-", "-", "09:40", "09:54", "10:05", "10:17", "10:29", "10:47"],
        ["1307", "2/13-2/21", "08:50", "09:01", "09:10", "-", "-", "-", "09:54", "10:05", "10:17", "10:29", "10:47", "11:00"],
        ["813", "ÊØèÊó•", "09:00", "09:11", "09:19", "09:34", "09:47", "09:58", "10:17", "10:30", "10:41", "10:55", "11:13", "11:25"],
        ["619", "ÊØèÊó•", "09:10", "09:21", "09:29", "09:43", "09:56", "-", "10:25", "-", "-", "10:50", "11:07", "11:20"],
        ["117", "ÊØèÊó•", "09:20", "09:31", "09:39", "-", "-", "-", "10:20", "-", "-", "-", "-", "11:05"],
        ["621", "ÊØèÊó•", "09:35", "09:46", "09:55", "10:10", "10:22", "-", "10:48", "-", "-", "11:14", "11:33", "11:45"],
        ["1213", "ÊØèÊó•", "09:40", "09:51", "09:59", "-", "-", "-", "10:40", "-", "-", "-", "11:18", "11:30"],
        ["1309", "2/13-2/14, 2/16-2/21", "09:50", "10:01", "10:20", "-", "-", "-", "10:54", "11:05", "11:17", "11:29", "11:47", "12:00"],
        ["817", "ÊØèÊó•", "10:00", "10:11", "10:19", "10:34", "10:47", "10:58", "11:17", "11:30", "11:41", "11:55", "12:13", "12:25"],
        ["625", "ÊØèÊó•", "10:10", "10:21", "10:29", "10:43", "10:56", "-", "11:25", "-", "-", "11:50", "12:07", "12:20"],
        ["121", "ÊØèÊó•", "10:20", "10:31", "10:39", "-", "-", "-", "11:20", "-", "-", "-", "-", "12:05"],
        ["1517", "2/13, 2/15, 2/17-2/18", "10:25", "10:36", "10:46", "11:01", "11:12", "11:22", "11:42", "-", "-", "12:14", "12:33", "12:45"],
        ["1217", "2/13-2/21", "10:40", "10:51", "10:59", "-", "-", "-", "11:40", "-", "-", "-", "12:18", "12:30"],
        ["1311", "2/13-2/14, 2/16-2/19, 2/23", "10:50", "11:01", "11:20", "-", "-", "-", "11:54", "12:06", "12:17", "12:29", "12:47", "13:00"],
        ["125", "ÊØèÊó•", "11:10", "11:21", "11:29", "-", "-", "-", "12:20", "-", "-", "-", "-", "13:05"],
        ["633", "ÊØèÊó•", "11:10", "11:21", "11:29", "11:43", "11:56", "-", "12:25", "-", "-", "12:50", "13:14", "-"],
        ["1221", "2/13, 2/15-2/21", "11:40", "11:51", "11:59", "-", "-", "-", "12:40", "-", "-", "-", "13:18", "13:30"],
        ["1313", "2/14-2/15", "11:50", "12:01", "12:20", "-", "-", "-", "12:54", "13:06", "13:17", "13:29", "13:47", "14:00"],
        ["825", "ÊØèÊó•", "12:00", "12:11", "12:19", "12:34", "12:47", "12:58", "13:17", "13:30", "13:41", "13:55", "14:13", "14:25"],
        ["637", "ÊØèÊó•", "12:10", "12:21", "12:29", "12:43", "12:56", "-", "13:25", "-", "-", "13:50", "14:07", "14:20"],
        ["129", "ÊØèÊó•", "12:20", "12:31", "12:39", "-", "-", "-", "13:20", "-", "-", "-", "-", "14:05"],
        ["639", "2/13-2/22", "12:35", "12:46", "12:55", "13:10", "13:22", "-", "13:48", "-", "-", "14:14", "14:33", "14:45"],
        ["1225", "ÊØèÊó•", "12:40", "12:51", "12:59", "-", "-", "-", "13:40", "-", "-", "-", "14:18", "14:30"],
        ["1315", "2/13-2/15, 2/18", "12:50", "13:01", "13:20", "-", "-", "-", "13:54", "14:05", "14:17", "14:29", "14:47", "15:00"],
        ["829", "ÊØèÊó•", "13:00", "13:11", "13:19", "13:34", "13:47", "13:58", "14:17", "14:30", "14:41", "14:55", "15:13", "15:25"],
        ["643", "ÊØèÊó•", "13:10", "13:21", "13:29", "13:43", "13:56", "-", "14:25", "-", "-", "14:50", "15:07", "15:20"],
        ["133", "ÊØèÊó•", "13:20", "13:31", "13:39", "-", "-", "-", "14:20", "-", "-", "-", "-", "15:05"],
        ["645", "ÊØèÊó•", "13:35", "13:46", "13:55", "14:10", "14:22", "-", "14:48", "-", "-", "15:14", "15:33", "15:45"],
        ["1229", "2/13-2/22", "13:40", "13:51", "13:59", "-", "-", "-", "14:40", "-", "-", "-", "15:18", "15:30"],
        ["1317", "2/13-2/18", "13:50", "14:01", "14:20", "-", "-", "-", "14:54", "15:06", "15:17", "15:29", "15:47", "16:00"],
        ["833", "ÊØèÊó•", "14:00", "14:11", "14:19", "14:34", "14:47", "14:58", "15:17", "15:30", "15:41", "15:55", "16:13", "16:25"],
        ["649", "ÊØèÊó•", "14:10", "14:21", "14:29", "14:43", "14:56", "-", "15:25", "-", "-", "15:50", "16:07", "16:20"],
        ["137", "ÊØèÊó•", "14:20", "14:31", "14:39", "-", "-", "-", "15:20", "-", "-", "-", "-", "16:05"],
        ["651", "ÊØèÊó•", "14:35", "14:46", "14:55", "15:10", "15:22", "-", "15:48", "-", "-", "16:14", "16:33", "16:45"],
        ["1233", "2/13-2/22", "14:40", "14:51", "14:59", "-", "-", "-", "15:40", "-", "-", "-", "16:18", "16:30"],
        ["1319", "2/13, 2/16-2/18, 2/21", "14:50", "15:01", "15:20", "-", "-", "-", "15:54", "16:06", "16:17", "16:29", "16:47", "17:00"],
        ["837", "ÊØèÊó•", "15:00", "15:11", "15:19", "15:34", "15:47", "15:58", "16:17", "16:30", "16:41", "16:55", "17:13", "17:25"],
        ["655", "ÊØèÊó•", "15:10", "15:21", "15:29", "15:43", "15:56", "-", "16:25", "-", "-", "16:50", "17:07", "17:20"],
        ["141", "ÊØèÊó•", "15:20", "15:31", "15:39", "-", "-", "-", "16:20", "-", "-", "-", "-", "17:05"],
        ["841", "ÊØèÊó•", "16:00", "16:11", "16:19", "16:34", "16:47", "16:58", "17:17", "17:30", "17:41", "17:55", "18:13", "18:25"],
        ["661", "ÊØèÊó•", "16:10", "16:21", "16:29", "16:43", "16:56", "-", "17:25", "-", "-", "17:50", "18:07", "18:20"],
        ["145", "ÊØèÊó•", "16:20", "16:31", "16:39", "-", "-", "-", "17:20", "-", "-", "-", "-", "18:05"],
        ["1241", "ÊØèÊó•", "16:40", "16:51", "16:59", "-", "-", "-", "17:40", "-", "-", "-", "18:18", "18:30"],
        ["1323", "2/14-2/15", "16:50", "17:01", "17:20", "-", "-", "-", "17:54", "18:06", "18:17", "18:29", "18:47", "19:00"],
        ["845", "ÊØèÊó•", "17:00", "17:11", "17:19", "17:34", "17:47", "17:58", "18:17", "18:30", "18:41", "18:55", "19:13", "19:25"],
        ["667", "ÊØèÊó•", "17:10", "17:21", "17:29", "17:43", "17:56", "-", "18:25", "-", "-", "18:50", "19:07", "19:20"],
        ["149", "ÊØèÊó•", "17:20", "17:31", "17:39", "-", "-", "-", "18:20", "-", "-", "-", "-", "19:05"],
        ["1245", "2/13-2/15, 2/17-2/22", "17:40", "17:51", "17:59", "-", "-", "-", "18:40", "-", "-", "-", "19:18", "19:30"],
        ["1325", "2/14-2/15", "17:50", "18:01", "18:20", "-", "-", "-", "18:54", "19:06", "19:17", "19:29", "19:47", "20:00"],
        ["853", "ÊØèÊó•", "19:00", "19:11", "19:19", "19:34", "19:47", "19:58", "20:17", "20:30", "20:41", "20:55", "21:13", "21:25"],
        ["157", "ÊØèÊó•", "19:20", "19:31", "19:39", "-", "-", "-", "20:20", "-", "-", "-", "-", "21:05"],
        ["857", "ÊØèÊó•", "20:00", "20:11", "20:19", "20:34", "20:47", "20:58", "21:17", "21:30", "21:41", "21:55", "22:13", "22:25"],
        ["161", "ÊØèÊó•", "20:20", "20:31", "20:39", "-", "-", "-", "21:20", "-", "-", "-", "-", "22:05"],
        ["861", "ÊØèÊó•", "21:00", "21:11", "21:19", "21:34", "21:47", "21:58", "22:17", "22:30", "22:41", "22:55", "23:13", "23:25"],
        ["165", "ÊØèÊó•", "21:20", "21:31", "21:39", "-", "-", "-", "22:20", "-", "-", "-", "-", "23:05"],
        ["333", "ÊØèÊó•", "21:45", "21:56", "22:15", "-", "-", "-", "22:49", "23:01", "23:12", "23:24", "23:42", "23:55"],
        ["295", "ÊØèÊó•", "22:05", "22:16", "22:35", "-", "-", "-", "23:07", "-", "-", "23:30", "23:48", "23:59"],
        ["567", "ÊØèÊó•", "22:35", "22:50", "23:08", "23:21", "23:32", "23:43", "23:59", "-", "-", "-", "-", "-"]
    ]
    cols_south = ["ËªäÊ¨°", "Ë°åÈßõÊó•", "ÂçóÊ∏Ø", "Âè∞Âåó", "ÊùøÊ©ã", "Ê°ÉÂúí", "Êñ∞Á´π", "ËãóÊ†ó", "Âè∞‰∏≠", "ÂΩ∞Âåñ", "Èõ≤Êûó", "ÂòâÁæ©", "Âè∞Âçó", "Â∑¶Ááü"]

    # Âåó‰∏äË≥áÊñô (Âè∞Âçó -> ÂçóÊ∏Ø)
    northbound_raw = [
        ["502", "ÊØèÊó•", "05:45", "05:57", "06:15", "06:29", "06:40", "06:52", "07:14", "07:27", "07:39", "07:50", "08:01", "08:10"],
        ["1504", "2/13, 2/23", "05:50", "06:08", "06:25", "06:38", "06:53", "07:05", "07:25", "07:37", "07:51", "08:05", "08:16", "08:25"],
        ["1202", "2/22", "05:55", "06:08", "06:25", "-", "-", "06:57", "-", "-", "-", "07:42", "07:53", "08:05"],
        ["300", "ÊØèÊó•", "05:50", "06:03", "06:21", "-", "-", "06:44", "-", "-", "07:29", "07:47", "07:55", "-"],
        ["1510", "2/13-2/14, 2/17-2/23", "06:25", "06:38", "06:57", "07:12", "07:25", "07:36", "07:58", "08:10", "08:24", "08:38", "08:47", "08:55"],
        ["802", "ÊØèÊó•", "06:15", "06:29", "06:48", "07:00", "07:13", "07:25", "07:45", "07:58", "08:12", "08:27", "08:40", "08:50"],
        ["1302", "2/13, 2/19-2/23", "06:45", "06:59", "07:19", "07:32", "07:42", "07:53", "-", "-", "-", "-", "08:47", "08:55"],
        ["204", "ÊØèÊó•", "06:55", "07:07", "-", "-", "-", "07:40", "-", "-", "-", "08:27", "08:37", "08:45"],
        ["606", "ÊØèÊó•", "07:00", "07:13", "07:32", "-", "-", "08:00", "-", "08:25", "08:38", "08:51", "09:02", "09:10"],
        ["806", "ÊØèÊó•", "07:25", "07:41", "08:00", "08:12", "08:24", "08:36", "08:56", "09:08", "09:20", "09:32", "09:42", "09:50"],
        ["610", "ÊØèÊó•", "07:35", "07:48", "08:08", "-", "-", "08:32", "-", "08:57", "09:11", "09:25", "09:36", "09:45"],
        ["1304", "2/18-2/19, 2/22-2/23", "07:45", "07:57", "08:19", "08:31", "08:41", "08:53", "-", "-", "-", "-", "09:47", "09:55"],
        ["109", "ÊØèÊó•", "07:55", "-", "-", "-", "-", "08:39", "-", "-", "-", "09:21", "09:32", "09:40"],
        ["1518", "2/14, 2/17-2/18, 2/22-2/23", "08:25", "08:38", "08:57", "09:12", "09:25", "09:36", "09:58", "10:10", "10:24", "10:38", "10:47", "10:55"],
        ["1210", "ÊØèÊó•", "08:15", "08:28", "08:45", "-", "-", "09:17", "-", "-", "-", "10:02", "10:13", "10:25"],  # ‰øÆÊ≠£ÔºöÂ∑¶Ááü 08:15 Áôº
        ["1306", "2/19-2/21", "08:45", "08:57", "09:19", "09:31", "09:41", "09:53", "-", "-", "-", "-", "10:47", "10:55"],
        ["1214", "ÊØèÊó•", "09:15", "09:28", "09:45", "-", "-", "10:17", "-", "-", "-", "11:02", "11:13", "11:25"],  # Êñ∞Â¢ûÔºöË£ú‰∏ä 09:15 ÁôºÁöÑËªäÊ¨°
        ["1522", "2/14, 2/19-2/22", "09:25", "09:38", "09:57", "10:12", "10:25", "10:36", "10:58", "11:10", "11:24", "11:38", "11:47", "11:55"],
        ["622", "ÊØèÊó•", "09:35", "09:48", "10:06", "-", "-", "10:32", "-", "10:57", "11:11", "11:25", "11:36", "11:45"],
        ["130", "2/16-2/22", "09:45", "09:57", "10:19", "10:31", "10:41", "10:53", "-", "-", "-", "-", "11:47", "11:55"],
        ["1310", "2/14-2/15, 2/19-2/22", "10:45", "10:57", "11:19", "11:31", "11:41", "11:53", "-", "-", "-", "-", "12:47", "12:55"],
        ["1530", "2/16-2/23", "11:25", "11:38", "11:57", "12:12", "12:25", "12:36", "12:58", "13:10", "13:24", "13:38", "13:47", "13:55"],
        ["1634", "ÊØèÊó•", "11:35", "11:48", "12:08", "-", "-", "12:32", "-", "12:57", "13:11", "13:25", "13:36", "13:45"],
        ["646", "ÊØèÊó•", "13:35", "13:48", "14:08", "-", "-", "14:32", "-", "14:57", "15:11", "15:25", "15:36", "15:45"],
        ["131", "2/19-2/23", "13:45", "13:57", "14:19", "14:31", "14:41", "14:53", "-", "-", "-", "-", "15:47", "15:55"],
        ["132", "ÊØèÊó•", "13:55", "-", "-", "-", "-", "14:39", "-", "-", "-", "15:21", "15:32", "15:40"],
        ["648", "ÊØèÊó•", "14:00", "14:13", "14:32", "-", "-", "15:00", "-", "15:25", "15:38", "15:51", "16:02", "16:10"],
        ["1542", "2/15-2/25", "14:25", "14:38", "14:57", "15:12", "15:25", "15:36", "15:58", "16:10", "16:24", "16:38", "16:47", "16:55"],
        ["1234", "ÊØèÊó•", "14:15", "14:28", "14:45", "-", "-", "15:17", "-", "-", "-", "16:02", "16:13", "16:25"],
        ["1318", "2/15, 2/16-2/22", "14:45", "14:57", "15:19", "15:31", "15:41", "15:53", "-", "-", "-", "-", "16:47", "16:55"],
        ["136", "ÊØèÊó•", "14:55", "-", "-", "-", "-", "15:39", "-", "-", "-", "16:21", "16:32", "16:40"],
        ["1238", "2/13, 2/15-2/23", "15:15", "15:28", "15:45", "-", "-", "16:17", "-", "-", "-", "17:02", "17:13", "17:25"],
        ["144", "ÊØèÊó•", "16:55", "-", "-", "-", "-", "17:39", "-", "-", "-", "18:21", "18:32", "18:40"],
        ["1554", "2/13, 2/15, 2/18-2/23", "17:25", "17:38", "17:57", "18:12", "18:25", "18:36", "18:58", "19:10", "19:24", "19:38", "19:47", "19:55"],
        ["1246", "2/13, 2/15, 2/17-2/23", "17:15", "17:28", "17:45", "-", "-", "18:17", "-", "-", "-", "19:02", "19:13", "19:25"],
        ["1324", "2/19-2/22", "17:45", "17:57", "18:19", "18:31", "18:41", "18:53", "-", "-", "-", "-", "19:47", "19:55"],
        ["155", "2/13, 2/15, 2/17-2/23", "18:00", "18:13", "18:32", "-", "-", "19:00", "-", "19:25", "19:39", "19:51", "20:02", "20:10"],
        ["1326", "2/18-2/22", "18:45", "18:57", "19:19", "19:31", "19:41", "19:53", "-", "-", "-", "-", "20:47", "20:55"],
        ["1562", "2/15, 2/17-2/22", "19:25", "19:38", "19:57", "20:12", "20:25", "20:36", "20:58", "21:10", "21:24", "21:38", "21:47", "21:55"],
        ["1254", "2/15, 2/17-2/23", "19:15", "19:28", "19:45", "-", "-", "20:17", "-", "-", "-", "21:02", "21:13", "21:25"],
        ["854", "2/15, 2/17-2/23", "19:25", "19:41", "20:00", "20:12", "20:24", "20:36", "20:56", "21:08", "21:20", "21:32", "21:42", "21:50"],
        ["1662", "2/13-2/15, 2/17-2/23", "19:35", "19:48", "20:08", "-", "-", "20:32", "-", "20:57", "21:11", "21:25", "21:36", "21:45"],
        ["1328", "2/13, 2/15, 2/17-2/22", "19:45", "19:57", "20:19", "20:31", "20:41", "20:53", "-", "-", "-", "-", "21:47", "21:55"],
        ["1566", "2/17-2/22", "20:25", "20:38", "20:57", "21:12", "21:25", "21:36", "21:58", "22:10", "22:24", "22:38", "22:47", "22:55"],
        ["160", "2/18-2/22", "20:45", "20:57", "21:19", "21:31", "21:42", "21:54", "-", "-", "-", "-", "22:49", "23:01"],
        ["600", "ÊØèÊó•", "21:05", "21:18", "21:37", "-", "-", "22:05", "-", "22:30", "22:43", "22:56", "23:07", "23:15"],
        ["1332", "2/19-2/22", "21:15", "21:29", "21:48", "22:00", "22:10", "22:22", "-", "-", "-", "-", "23:16", "23:25"],
        ["862", "ÊØèÊó•", "21:30", "21:44", "22:03", "22:16", "22:28", "22:40", "23:00", "23:12", "23:25", "23:37", "23:47", "23:55"],
        ["1264", "2/13, 2/15, 2/17-2/22", "21:40", "21:53", "22:11", "-", "-", "22:30", "-", "-", "-", "23:11", "23:21", "23:30"],
        ["1336", "2/15, 2/16-2/22", "21:50", "22:03", "22:21", "22:33", "22:43", "22:55", "-", "-", "-", "-", "23:56", "00:05"],
        ["696", "ÊØèÊó•", "21:55", "22:11", "22:32", "-", "-", "22:59", "-", "23:27", "23:40", "23:52", "23:59", "-"],
        ["1330", "2/19-2/21", "22:05", "22:18", "22:40", "22:52", "23:02", "23:14", "-", "-", "-", "-", "23:47", "00:07"],
        ["294", "ÊØèÊó•", "22:10", "22:23", "22:33", "-", "-", "23:03", "-", "-", "-", "23:42", "23:52", "23:59"],
        ["1096", "2/19-2/22", "22:20", "22:33", "22:52", "-", "-", "23:20", "-", "-", "-", "23:45", "23:58", "00:11"],
        ["599", "2/13-2/19, 2/22-2/23", "22:55", "23:08", "23:27", "23:38", "23:49", "23:59", "-", "-", "-", "-", "-", "-"]
    ]
    cols_north = ["ËªäÊ¨°", "Ë°åÈßõÊó•", "Â∑¶Ááü", "Âè∞Âçó", "ÂòâÁæ©", "Èõ≤Êûó", "ÂΩ∞Âåñ", "Âè∞‰∏≠", "ËãóÊ†ó", "Êñ∞Á´π", "Ê°ÉÂúí", "ÊùøÊ©ã", "Âè∞Âåó", "ÂçóÊ∏Ø"]
    
    return southbound_raw, cols_south, northbound_raw, cols_north

# ==========================================
# 2. ËºîÂä©ÂáΩÂºèÔºöÊ™¢Êü•Êó•ÊúüÊòØÂê¶Âú®Ë°åÈßõÊó•ÁØÑÂúç
# ==========================================
def is_train_operating(selected_date_str, op_day_str):
    if op_day_str.strip() == "ÊØèÊó•":
        return True
    
    sel_dt = datetime.strptime(selected_date_str, "%Y/%m/%d")
    sel_md = f"{sel_dt.month}/{sel_dt.day}"
    
    parts = op_day_str.replace(" ", "").split(",")
    
    for part in parts:
        if "-" in part:
            start_s, end_s = part.split("-")
            def parse_md(s):
                try:
                    m, d = map(int, s.split("/"))
                    return m * 100 + d
                except:
                    return 0
            
            val_sel = parse_md(sel_md)
            val_start = parse_md(start_s)
            val_end = parse_md(end_s)
            
            if val_start <= val_sel <= val_end:
                return True
        else:
            if part == sel_md:
                return True
    return False

# ==========================================
# 3. ËºîÂä©ÂáΩÂºèÔºöË®àÁÆóÊôÇÈñìÂ∑Æ (ÂàÜÈêò)
# ==========================================
def calculate_duration(start_time_str, end_time_str):
    if start_time_str == "-" or end_time_str == "-":
        return 9999 
    
    fmt = "%H:%M"
    t_start = datetime.strptime(start_time_str, fmt)
    t_end = datetime.strptime(end_time_str, fmt)
    
    if t_end < t_start:
        duration_seconds = (t_end - t_start).total_seconds() + 24*3600
    else:
        duration_seconds = (t_end - t_start).total_seconds()
        
    return int(duration_seconds / 60)

# ==========================================
# 4. ‰∏ªÁ®ãÂºè UI
# ==========================================
def main():
    st.set_page_config(page_title="2026 Êò•ÁØÄÈ´òÈêµÊôÇÂàªË°®Êü•Ë©¢", page_icon="üöÖ")
    
    st.title("üöÖ 2026 Êò•ÁØÄÈ´òÈêµÊôÇÂàªÊü•Ë©¢ Web App")
    st.markdown("Âø´ÈÄüÁØ©ÈÅ∏ **Âè∞Âçó ‚Üî ÂçóÊ∏Ø** Ë°åËªäÊôÇÈñìÂ∞èÊñº 120 ÂàÜÈêòÁöÑÁè≠Ê¨°")

    # ÂèñÂæóË≥áÊñô
    south_data, south_cols, north_data, north_cols = get_data()

    # --- ÂÅ¥ÈÇäÊ¨ÑÔºöÁØ©ÈÅ∏Ê¢ù‰ª∂ ---
    st.sidebar.header("üîç Êü•Ë©¢Ê¢ù‰ª∂")
    
    # 1. ÈÅ∏ÊìáÊñπÂêë
    direction = st.sidebar.radio("ÊñπÂêëÈÅ∏Êìá", ["Âçó‰∏ã (ÂçóÊ∏Ø ‚Üí Âè∞Âçó)", "Âåó‰∏ä (Âè∞Âçó ‚Üí ÂçóÊ∏Ø)"])
    
    # 2. ÈÅ∏ÊìáÊó•Êúü
    date_options = [f"2026/02/{d:02d}" for d in range(13, 24)] # 2/13 - 2/23
    selected_date = st.sidebar.selectbox("ÈÅ∏ÊìáÊó•Êúü", date_options)
    
    # 3. ÈÅ∏ÊìáÊôÇÈñìÁØÑÂúç
    time_range = st.sidebar.slider(
        "ÁôºËªäÊôÇÈñìÁØÑÂúç",
        value=(time(6, 0), time(23, 59)),
        format="HH:mm"
    )

    # --- Ë≥áÊñôËôïÁêÜÈÇèËºØ ---
    if "Âçó‰∏ã" in direction:
        df = pd.DataFrame(south_data, columns=south_cols)
        start_station = "ÂçóÊ∏Ø"
        end_station = "Âè∞Âçó"
    else:
        df = pd.DataFrame(north_data, columns=north_cols)
        start_station = "Âè∞Âçó"
        end_station = "ÂçóÊ∏Ø"

    # Áî®‰æÜÂ≠òÊîæÁØ©ÈÅ∏ÂæåÁöÑÁµêÊûú
    results = []

    for index, row in df.iterrows():
        train_no = row["ËªäÊ¨°"]
        op_day = row["Ë°åÈßõÊó•"]
        t_start = row[start_station]
        t_end = row[end_station]

        # ÈÅéÊøæÈÇèËºØ
        if not is_train_operating(selected_date, op_day):
            continue
        if t_start == "-" or t_end == "-":
            continue
        
        dep_time_obj = datetime.strptime(t_start, "%H:%M").time()
        if not (time_range[0] <= dep_time_obj <= time_range[1]):
            continue

        duration = calculate_duration(t_start, t_end)

        # ÈÄôË£°Â∞áË°åËªäÊôÇÈñìÂä†ÂÖ•Ê∏ÖÂñÆÔºåÊñπ‰æøÂæåÁ∫åÈ°ØÁ§∫
        if duration <= 120:
            results.append({
                "ËªäÊ¨°": train_no,
                "ÁôºËªäÊôÇÈñì": t_start,
                "ÊäµÈÅîÊôÇÈñì": t_end,
                "Ë°åËªäÊôÇÈñì (ÂàÜ)": duration, # ÈóúÈçµÊ¨Ñ‰Ωç
                "Ë°åÈßõÂÇôË®ª": op_day
            })

    # ËΩâÁÇ∫ DataFrame ‰∏¶ÊéíÂ∫è
    if results:
        result_df = pd.DataFrame(results)
        result_df = result_df.sort_values(by="ÁôºËªäÊôÇÈñì")
        
        st.subheader(f"Êü•Ë©¢ÁµêÊûúÔºö{selected_date} ({direction})")
        st.write(f"ÂÖ±ÊâæÂà∞ **{len(result_df)}** Áè≠Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁõ¥ÈÅî/Âø´ËªäÔºàË°åËªä ‚â§ 120 ÂàÜÔºâÔºåÂ∑≤ÊåâÁôºËªäÈ†ÜÂ∫èÊéíÂàóÔºö")
        
        # È°ØÁ§∫Ë°®Ê†º (ÈáùÂ∞ç 'Ë°åËªäÊôÇÈñì (ÂàÜ)' ÈÄ≤Ë°åÈ°èËâ≤Êº∏Â±§ highlightÔºåÊôÇÈñìË∂äÁü≠Ë∂äÈ°ØÁúº)
        st.dataframe(
            result_df.style.background_gradient(subset=["Ë°åËªäÊôÇÈñì (ÂàÜ)"], cmap="Greens_r"),
            use_container_width=True,
            hide_index=True,
            column_config={
                "ËªäÊ¨°": st.column_config.TextColumn("ËªäÊ¨°", width="small"),
                "Ë°åËªäÊôÇÈñì (ÂàÜ)": st.column_config.NumberColumn("Ë°åËªäÊôÇÈñì (ÂàÜ)", format="%d ÂàÜÈêò"),
            }
        )
    else:
        st.warning("‚ö†Ô∏è Âú®Ê≠§ÊôÇÊÆµÂÖßÊâæ‰∏çÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁè≠Ê¨°ÔºàÂèØËÉΩË©≤ÊôÇÊÆµÁöÜÁÇ∫Á´ôÁ´ôÂÅúÂàóËªäÔºåË°åËªäÊôÇÈñìË∂ÖÈÅé 120 ÂàÜÈêòÔºâ„ÄÇ")

if __name__ == "__main__":
    main()
